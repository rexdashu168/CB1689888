# 🔧 可轉債查詢系統 - 問題排除指南

## ❓ 問題：一直顯示「正在載入競拍資料...」

當系統一直卡在載入畫面，通常是以下幾個原因之一：

---

## 🔍 診斷步驟

### Step 1：使用診斷工具（最快速）

我們已經準備好一個診斷工具，可以自動幫您檢查問題！

**操作方式：**
1. 在瀏覽器中開啟 **診斷工具.html**
2. 點擊「🔍 開始診斷」按鈕
3. 查看診斷結果

診斷工具會自動檢查：
- ✅ 瀏覽器是否支援
- ✅ XLSX函式庫是否載入
- ✅ 檔案路徑是否正確
- ✅ Excel檔案是否能正常讀取
- ✅ 資料格式是否正確

---

### Step 2：手動檢查（如果診斷工具無法開啟）

#### ✅ 檢查項目 1：檔案位置

**問題：**Excel檔案放錯位置

**確認方式：**
- `index_complete.html` 和 `auction_data.xlsx` 必須在**同一個資料夾**
- 檔案名稱必須完全正確（區分大小寫）

**正確的檔案結構：**
```
資料夾/
├── index_complete.html  ← HTML檔案
├── auction_data.xlsx    ← Excel資料檔
└── 診斷工具.html         ← 診斷工具（選用）
```

**錯誤的檔案結構：**
```
❌ 錯誤範例 1：
資料夾/
├── index_complete.html
└── data/
    └── auction_data.xlsx  ← Excel在子資料夾（錯誤！）

❌ 錯誤範例 2：
資料夾/
├── index_complete.html
└── Auction_Data.xlsx  ← 檔名大小寫不對（錯誤！）
```

---

#### ✅ 檢查項目 2：檔案名稱

**確認要點：**
- 檔案名稱必須是：`auction_data.xlsx`
- 注意大小寫（全部小寫）
- 注意底線：`auction_data` 不是 `auction-data` 或 `auctiondata`

**常見錯誤：**
- ❌ `Auction_Data.xlsx` （大寫A和D）
- ❌ `auction-data.xlsx` （用連字號）
- ❌ `auction_data (1).xlsx` （有編號）
- ❌ `auction_data.XLSX` （副檔名大寫）

---

#### ✅ 檢查項目 3：瀏覽器

**問題：**瀏覽器不支援或有快取問題

**解決方式：**

1. **推薦使用的瀏覽器：**
   - ✅ Google Chrome（推薦）
   - ✅ Microsoft Edge（推薦）
   - ✅ Firefox
   - ⚠️ Safari（可能有限制）
   - ❌ IE（不支援）

2. **清除快取並重新載入：**
   - **Windows:** 按 `Ctrl + F5` 或 `Ctrl + Shift + R`
   - **Mac:** 按 `Cmd + Shift + R`

3. **檢查開發者工具：**
   - 按 `F12` 開啟開發者工具
   - 切換到「Console」標籤
   - 查看是否有紅色錯誤訊息

---

#### ✅ 檢查項目 4：開啟方式

**問題：**使用 `file://` 協定開啟可能有限制

**確認方式：**
查看瀏覽器網址列：
- ❌ `file:///C:/Users/...` （可能有CORS限制）
- ✅ `http://localhost:...` （本地伺服器，推薦）
- ✅ `https://your-site.com/...` （網站，推薦）

**解決方式：**

**方法 1：使用本地伺服器（推薦）**

如果您使用 VS Code：
1. 安裝「Live Server」外掛
2. 右鍵點擊 HTML 檔案
3. 選擇「Open with Live Server」

**方法 2：使用Python簡易伺服器**
```bash
# 在檔案所在資料夾開啟終端機/命令提示字元
# Python 3
python -m http.server 8000

# 然後在瀏覽器開啟
http://localhost:8000/index_complete.html
```

**方法 3：上傳到網站空間**
- 上傳到 GitHub Pages
- 上傳到自己的網站空間

---

#### ✅ 檢查項目 5：Excel檔案

**問題：**Excel檔案損壞或格式錯誤

**檢查方式：**
1. 用 Excel 或 WPS 開啟 `auction_data.xlsx`
2. 確認能正常開啟
3. 確認有資料（不是空白）
4. 確認第一列是欄位名稱

**必要欄位檢查：**
Excel 第一列必須包含這些欄位：
```
序號、開標日期、股票代號、CB代號、名稱、
股本、發行規模、年期、擔保、信評、
競拍張數、底標價、截標日、截標收盤、轉換價、
訂價溢價率、理論價、最低得標、最低溢價、
平均得標、平均溢價、掛牌最高、掛牌最低、
發行券商、產業分類、合格件數、投標張數、
投標倍數、投標均張、CB最新收盤價
```

**如果欄位不對：**
- 請確認使用正確版本的 Excel 檔案
- 不要修改欄位名稱
- 不要刪除欄位

---

## 🎯 快速解決方案彙整

### 情境1：第一次使用

**步驟：**
1. ✅ 確認 HTML 和 Excel 在同一個資料夾
2. ✅ 確認檔案名稱正確：`auction_data.xlsx`
3. ✅ 使用 Chrome 或 Edge 瀏覽器
4. ✅ 開啟 `index_complete.html`
5. ✅ 如果還是失敗，開啟「診斷工具.html」檢查

---

### 情境2：之前能用，現在不能用

**可能原因與解決：**

**原因1：檔案被移動了**
- ✅ 確認 Excel 檔案還在原位置
- ✅ 確認沒有被移到其他資料夾

**原因2：檔案被重新命名**
- ✅ 確認檔名還是 `auction_data.xlsx`
- ✅ 確認沒有 (1)、(2) 等編號

**原因3：瀏覽器快取**
- ✅ 按 Ctrl+F5 重新整理
- ✅ 清除瀏覽器快取

**原因4：Excel檔案更新時出錯**
- ✅ 檢查 Excel 檔案能否正常開啟
- ✅ 確認資料格式沒有改變

---

### 情境3：使用 file:// 協定

**問題：**
瀏覽器網址列顯示 `file:///...`

**解決：**
改用本地伺服器開啟（參考「檢查項目4」）

---

## 🔍 進階除錯

### 使用瀏覽器開發者工具

1. **開啟開發者工具：**
   - 按 `F12` 鍵

2. **查看 Console 標籤：**
   - 尋找紅色錯誤訊息
   - 常見錯誤訊息：

   **❌ "404 Not Found"**
   → 找不到檔案，檢查檔案位置和名稱

   **❌ "CORS policy"**
   → 跨域問題，改用本地伺服器

   **❌ "Failed to fetch"**
   → 無法載入檔案，檢查檔案是否存在

   **❌ "Unexpected token"**
   → 檔案格式錯誤，檢查Excel檔案

3. **查看 Network 標籤：**
   - 重新整理頁面
   - 找到 `auction_data.xlsx` 的請求
   - 查看狀態碼：
     - ✅ 200 = 成功
     - ❌ 404 = 找不到檔案
     - ❌ 403 = 沒有權限

---

## 📞 還是無法解決？

### 資訊收集

如果以上方法都試過了還是不行，請收集以下資訊：

1. **診斷工具結果：**
   - 執行「診斷工具.html」
   - 截圖完整的診斷結果

2. **開發者工具錯誤訊息：**
   - 按 F12
   - 切換到 Console 標籤
   - 截圖所有紅色錯誤訊息

3. **環境資訊：**
   - 使用的瀏覽器和版本
   - 作業系統（Windows/Mac/Linux）
   - 開啟方式（file:// 或 http://）

4. **檔案確認：**
   - 截圖檔案總管，顯示兩個檔案在同一資料夾
   - 確認 Excel 能正常開啟

---

## ✅ 成功指標

當系統正常運作時，您會看到：

```
📅 競拍資料期間：2025年5月～2025年10月，共計 290 檔 | 
💰 CB最新收盤價：2025/10/27
```

而不是：
```
📅 正在載入競拍資料...  ← 如果卡在這裡就是有問題
```

---

## 🎉 預防措施

為了避免未來再次遇到問題：

1. **不要移動檔案**
   - HTML 和 Excel 永遠放在同一個資料夾

2. **不要改檔名**
   - Excel 檔案永遠叫 `auction_data.xlsx`

3. **使用本地伺服器**
   - 不要直接用 file:// 開啟
   - 推薦使用 VS Code + Live Server

4. **定期備份**
   - 保留一份乾淨的檔案副本
   - 更新資料前先備份

5. **使用推薦瀏覽器**
   - Chrome 或 Edge
   - 保持瀏覽器更新

---

**祝您使用順利！** 🎊

如果問題已解決，建議將此指南保存起來，
方便日後參考。

---

**by Rex大叔的168台股投資教室**
